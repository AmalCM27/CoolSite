var kio=function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=NaN,n="[object Symbol]",o=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,a=/^0o[0-7]+$/i,s=parseInt,u="object"==typeof e&&e&&e.Object===Object&&e,c="object"==typeof self&&self&&self.Object===Object&&self,l=u||c||Function("return this")(),d=Object.prototype.toString,f=Math.max,m=Math.min,v=function(){return l.Date.now()};function g(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&d.call(e)==n}(e))return t;if(g(e)){var u="function"==typeof e.valueOf?e.valueOf():e;e=g(u)?u+"":u}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var c=r.test(e);return c||a.test(e)?s(e.slice(2),c?2:8):i.test(e)?t:+e}var h=function(e,t,n){var o,i,r,a,s,u,c=0,l=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=o,r=i;return o=i=void 0,c=t,a=e.apply(r,n)}function w(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-c>=r}function y(){var e=v();if(w(e))return O(e);s=setTimeout(y,function(e){var n=t-(e-u);return d?m(n,r-(e-c)):n}(e))}function O(e){return s=void 0,h&&o?b(e):(o=i=void 0,a)}function k(){var e=v(),n=w(e);if(o=arguments,i=this,u=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(y,t),l?b(e):a}(u);if(d)return s=setTimeout(y,t),b(u)}return void 0===s&&(s=setTimeout(y,t)),a}return t=p(t)||0,g(n)&&(l=!!n.leading,r=(d="maxWait"in n)?f(p(n.maxWait)||0,t):r,h="trailing"in n?!!n.trailing:h),k.cancel=function(){void 0!==s&&clearTimeout(s),c=0,o=u=i=s=void 0},k.flush=function(){return void 0===s?a:O(v())},k},b=Uint8Array,w=Uint16Array,y=Int32Array,O=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),k=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),j=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),T=function(e,t){for(var n=new w(31),o=0;o<31;++o)n[o]=t+=1<<e[o-1];var i=new y(n[30]);for(o=1;o<30;++o)for(var r=n[o];r<n[o+1];++r)i[r]=r-n[o]<<5|o;return{b:n,r:i}},E=T(O,2),I=E.b,M=E.r;I[28]=258,M[258]=28;for(var A=T(k,0).r,_=new w(32768),x=0;x<32768;++x){var $=(43690&x)>>1|(21845&x)<<1;$=(61680&($=(52428&$)>>2|(13107&$)<<2))>>4|(3855&$)<<4,_[x]=((65280&$)>>8|(255&$)<<8)>>1}var C=function(e,t,n){for(var o=e.length,i=0,r=new w(t);i<o;++i)e[i]&&++r[e[i]-1];var a,s=new w(t);for(i=1;i<t;++i)s[i]=s[i-1]+r[i-1]<<1;if(n){a=new w(1<<t);var u=15-t;for(i=0;i<o;++i)if(e[i])for(var c=i<<4|e[i],l=t-e[i],d=s[e[i]-1]++<<l,f=d|(1<<l)-1;d<=f;++d)a[_[d]>>u]=c}else for(a=new w(o),i=0;i<o;++i)e[i]&&(a[i]=_[s[e[i]-1]++]>>15-e[i]);return a},D=new b(288);for(x=0;x<144;++x)D[x]=8;for(x=144;x<256;++x)D[x]=9;for(x=256;x<280;++x)D[x]=7;for(x=280;x<288;++x)D[x]=8;var L=new b(32);for(x=0;x<32;++x)L[x]=5;var S=C(D,9,0),q=C(L,5,0),N=function(e){return(e+7)/8|0},z=function(e,t,n){n<<=7&t;var o=t/8|0;e[o]|=n,e[o+1]|=n>>8},U=function(e,t,n){n<<=7&t;var o=t/8|0;e[o]|=n,e[o+1]|=n>>8,e[o+2]|=n>>16},R=function(e,t){for(var n=[],o=0;o<e.length;++o)e[o]&&n.push({s:o,f:e[o]});var i=n.length,r=n.slice();if(!i)return{t:F,l:0};if(1==i){var a=new b(n[0].s+1);return a[n[0].s]=1,{t:a,l:1}}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],u=n[1],c=0,l=1,d=2;for(n[0]={s:-1,f:s.f+u.f,l:s,r:u};l!=i-1;)s=n[n[c].f<n[d].f?c++:d++],u=n[c!=l&&n[c].f<n[d].f?c++:d++],n[l++]={s:-1,f:s.f+u.f,l:s,r:u};var f=r[0].s;for(o=1;o<i;++o)r[o].s>f&&(f=r[o].s);var m=new w(f+1),v=P(n[l-1],m,0);if(v>t){o=0;var g=0,p=v-t,h=1<<p;for(r.sort((function(e,t){return m[t.s]-m[e.s]||e.f-t.f}));o<i;++o){var y=r[o].s;if(!(m[y]>t))break;g+=h-(1<<v-m[y]),m[y]=t}for(g>>=p;g>0;){var O=r[o].s;m[O]<t?g-=1<<t-m[O]++-1:++o}for(;o>=0&&g;--o){var k=r[o].s;m[k]==t&&(--m[k],++g)}v=t}return{t:new b(m),l:v}},P=function(e,t,n){return-1==e.s?Math.max(P(e.l,t,n+1),P(e.r,t,n+1)):t[e.s]=n},Q=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new w(++t),o=0,i=e[0],r=1,a=function(e){n[o++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++r;else{if(!i&&r>2){for(;r>138;r-=138)a(32754);r>2&&(a(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(a(i),--r;r>6;r-=6)a(8304);r>2&&(a(r-3<<5|8208),r=0)}for(;r--;)a(i);r=1,i=e[s]}return{c:n.subarray(0,o),n:t}},H=function(e,t){for(var n=0,o=0;o<t.length;++o)n+=e[o]*t[o];return n},J=function(e,t,n){var o=n.length,i=N(t+2);e[i]=255&o,e[i+1]=o>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var r=0;r<o;++r)e[i+r+4]=n[r];return 8*(i+4+o)},G=function(e,t,n,o,i,r,a,s,u,c,l){z(t,l++,n),++i[256];for(var d=R(i,15),f=d.t,m=d.l,v=R(r,15),g=v.t,p=v.l,h=Q(f),b=h.c,y=h.n,T=Q(g),E=T.c,I=T.n,M=new w(19),A=0;A<b.length;++A)++M[31&b[A]];for(A=0;A<E.length;++A)++M[31&E[A]];for(var _=R(M,7),x=_.t,$=_.l,N=19;N>4&&!x[j[N-1]];--N);var P,G,W,F,V=c+5<<3,B=H(i,D)+H(r,L)+a,K=H(i,f)+H(r,g)+a+14+3*N+H(M,x)+2*M[16]+3*M[17]+7*M[18];if(u>=0&&V<=B&&V<=K)return J(t,l,e.subarray(u,u+c));if(z(t,l,1+(K<B)),l+=2,K<B){P=C(f,m,0),G=f,W=C(g,p,0),F=g;var X=C(x,$,0);z(t,l,y-257),z(t,l+5,I-1),z(t,l+10,N-4),l+=14;for(A=0;A<N;++A)z(t,l+3*A,x[j[A]]);l+=3*N;for(var Z=[b,E],Y=0;Y<2;++Y){var ee=Z[Y];for(A=0;A<ee.length;++A){var te=31&ee[A];z(t,l,X[te]),l+=x[te],te>15&&(z(t,l,ee[A]>>5&127),l+=ee[A]>>12)}}}else P=S,G=D,W=q,F=L;for(A=0;A<s;++A){var ne=o[A];if(ne>255){U(t,l,P[(te=ne>>18&31)+257]),l+=G[te+257],te>7&&(z(t,l,ne>>23&31),l+=O[te]);var oe=31&ne;U(t,l,W[oe]),l+=F[oe],oe>3&&(U(t,l,ne>>5&8191),l+=k[oe])}else U(t,l,P[ne]),l+=G[ne]}return U(t,l,P[256]),l+G[256]},W=new y([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new b(0),V=function(e,t,n,o,i,r){var a=r.z||e.length,s=new b(o+a+5*(1+Math.ceil(a/7e3))+i),u=s.subarray(o,s.length-i),c=r.l,l=7&(r.r||0);if(t){l&&(u[0]=r.r>>3);for(var d=W[t-1],f=d>>13,m=8191&d,v=(1<<n)-1,g=r.p||new w(32768),p=r.h||new w(v+1),h=Math.ceil(n/3),j=2*h,T=function(t){return(e[t]^e[t+1]<<h^e[t+2]<<j)&v},E=new y(25e3),I=new w(288),_=new w(32),x=0,$=0,C=r.i||0,D=0,L=r.w||0,S=0;C+2<a;++C){var q=T(C),z=32767&C,U=p[q];if(g[z]=U,p[q]=z,L<=C){var R=a-C;if((x>7e3||D>24576)&&(R>423||!c)){l=G(e,u,0,E,I,_,$,D,S,C-S,l),D=x=$=0,S=C;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)_[P]=0}var Q=2,H=0,F=m,V=z-U&32767;if(R>2&&q==T(C-V))for(var B=Math.min(f,R)-1,K=Math.min(32767,C),X=Math.min(258,R);V<=K&&--F&&z!=U;){if(e[C+Q]==e[C+Q-V]){for(var Z=0;Z<X&&e[C+Z]==e[C+Z-V];++Z);if(Z>Q){if(Q=Z,H=V,Z>B)break;var Y=Math.min(V,Z-2),ee=0;for(P=0;P<Y;++P){var te=C-V+P&32767,ne=te-g[te]&32767;ne>ee&&(ee=ne,U=te)}}}V+=(z=U)-(U=g[z])&32767}if(H){E[D++]=268435456|M[Q]<<18|A[H];var oe=31&M[Q],ie=31&A[H];$+=O[oe]+k[ie],++I[257+oe],++_[ie],L=C+Q,++x}else E[D++]=e[C],++I[e[C]]}}for(C=Math.max(C,L);C<a;++C)E[D++]=e[C],++I[e[C]];l=G(e,u,c,E,I,_,$,D,S,C-S,l),c||(r.r=7&l|u[l/8|0]<<3,l-=7,r.h=p,r.p=g,r.i=C,r.w=L)}else{for(C=r.w||0;C<a+c;C+=65535){var re=C+65535;re>=a&&(u[l/8|0]=c,re=a),l=J(u,l+1,e.subarray(C,re))}r.i=a}return function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new b(e.subarray(t,n))}(s,0,o+N(l)+i)},B=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,o=9;--o;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),K=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8};function X(e,t){t||(t={});var n=function(){var e=-1;return{p:function(t){for(var n=e,o=0;o<t.length;++o)n=B[255&n^t[o]]^n>>>8;e=n},d:function(){return~e}}}(),o=e.length;n.p(e);var i,r=function(e,t,n,o,i){if(!i&&(i={l:1},t.dictionary)){var r=t.dictionary.subarray(-32768),a=new b(r.length+e.length);a.set(r),a.set(e,r.length),e=a,i.w=r.length}return V(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,o,i)}(e,t,10+((i=t).filename?i.filename.length+1:0),8),a=r.length;return function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&K(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var o=0;o<=n.length;++o)e[o+10]=n.charCodeAt(o)}}(r,t),K(r,a-8,n.d()),K(r,a-4,o),r}var Z="undefined"!=typeof TextDecoder&&new TextDecoder;try{Z.decode(F,{stream:!0}),1}catch(e){}const Y=new TextEncoder,ee=e=>"string"==typeof e?e:JSON.stringify(e);function te(e,t,n,o){const i=new XMLHttpRequest;i.open("POST",e,!n),i.setRequestHeader("Content-Type",(o?"text/plain":"application/json")+"; charset=utf-8"),i.send(ee(t))}const ne=(e,t)=>{te(e,t,!0,!0)},oe=(e,t)=>{if("Request"in window&&"keepalive"in Request.prototype)((e,t)=>{fetch(e,{method:"POST",keepalive:!0,headers:{"Content-Type":"text/plain; charset=utf-8"},body:ee(t),credentials:"omit"}).then((e=>e),(e=>{})).catch((()=>{}))})(e,t);else if("sendBeacon"in navigator)try{if(!navigator.sendBeacon(e,ee(t)))throw new Error}catch(n){ne(e,t)}else ne(e,t)};function ie(e){window.parent.postMessage(JSON.stringify(e),"*")}function re(e,t,n){const[o,...i]=e.trim().split("?"),r=i.join("?");if(!r)return`${o}?${t}=${n}`;const a=r.split("#")[1],s=ce(e),u=s.map((e=>e.key)).indexOf(t);return`${o}?${(u>-1?s.slice(0,u).concat([{key:t,value:n}],s.slice(u+1)):s.concat([{key:t,value:n}])).map((e=>`${e.key}=${e.value}`)).join("&")}${a?"#":""}${a||""}`}function ae(e){return JSON.parse(JSON.stringify(e))}function se(e,...t){const n=e.tagName.toLowerCase();return t.indexOf(n)>-1}function ue(){return function(e){const t=document.cookie;if(""===t)return"";const n=t.split("; ");for(let t=0;t<n.length;t++){const o=n[t],i=o.indexOf("=");if(decodeURIComponent(o.substring(0,i))===e)return decodeURIComponent(o.substring(i+1))}return""}("qhdi")||"none"}function ce(e){return((e.trim().split("?")[1]||"").split("#")[0]||"").replace(/&+/g,"&").split("&").filter((e=>e)).map((e=>{const t=e.split("=");return{key:t[0],value:t.slice(1).join("=")}}))}function le(e){const t=ce(e),n={utm_campaign:"",utm_content:"",utm_medium:"",utm_source:""},o=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];o.indexOf(i.key)>-1&&(n[i.key]=i.value)}return n}function de(e){const{pathname:t,host:n,hash:o}=window.location;if(!e||"history"===e.toLowerCase())return n+t;const i=-1===o.indexOf("?")?void 0:o.indexOf("?");return"/"===t[t.length-1]?n+t+o.slice(2,i):n+t+o.slice(1,i)}const fe="actionstat.kujiale.com",me={sendManualTrack(e,t,n=!1){te(`https://${fe}/api/toolbehaviors/${e}/${n?"multilog":"log"}`,t)},sendAutoTrack(e,t){t?navigator.sendBeacon?navigator.sendBeacon(`https://${fe}/v2/api/eventtrack/text`,JSON.stringify(e)):te(`https://${fe}/v2/api/eventtrack`,e,!0):te(`https://${fe}/v2/api/eventtrack`,e)},sendConversionGoal(e){te(`https://${fe}/api/toolbehaviors/yuntaiGeneralTargetAction/log`,e)}},ve="data-kioid",ge="data-kio",pe="data-kmetricname",he="data-kmetrics",be="data-kiocg";function we(e){return e.getAttribute(pe)||""}function ye(e){return je(e,ge)}function Oe(e){return je(e,he)}function ke(e){return e.getAttribute(be)||""}function je(e,t){return Array.prototype.reduce.call(e.attributes,((e,n)=>{if(0===n.name.indexOf(t+"-")||0===n.name.indexOf(t+"_")){const o=n.name.slice(t.length).match(/^_?(\w*)-?(.*)$/),i=o?o[1]:"",r=o?o[2].split("-").map(((e,t)=>t>0?e[0].toUpperCase()+e.slice(1):e)).join(""):"",a=n.value;if("number"===i)return Object.assign(e,{[r]:Number(a)});if("string"===i)return Object.assign(e,{[r]:String(a)});if("json"===i)try{return Object.assign(e,{[r]:JSON.parse(a)})}catch(t){return Object.assign(e,{[r]:a})}return"true"===a||"false"===a?Object.assign(e,{[r]:"true"===a}):Object.assign(e,{[r]:a})}return e}),{})}function Te(e,t){let n={},o={},i={},r="",a="",s=e,u=null;const c=[],l=[],d=[];for(;s&&!se(s,"html");){!u&&se(s,"a")&&(u=s,n=Object.assign(n,{href:(m=u.getAttribute("href")||"",0===m.indexOf("data:")?m.slice(0,m.indexOf(",")):m)})),""===r&&(r=we(s),r&&(i=Oe(s)));const e=ye(s);f=e,0!==Object.keys(f).length&&(o=Object.assign(e,o)),""===a&&(a=ke(s));const{pathUnit:v,elementIdUnit:g,classIdUnit:p}=Ie(s,t.classIdMode);c.unshift(v),l.unshift(g),t.classIdMode&&d.unshift(p),s=s.parentElement}var f,m,v;return n=Object.assign(n,function(e){const{top:t,right:n,bottom:o,left:i}=e.getBoundingClientRect(),r=window.pageYOffset,a=window.pageXOffset;return{top:Math.round(t+r),right:Math.round(n+a),bottom:Math.round(o+r),left:Math.round(i+a)}}(e),{nodeText:_e(u||e),title:xe(u||e),elementId:(v=l,["html"].concat(v).reverse().reduce(((e,t)=>0===e.length?e.concat(t):e[e.length-1].indexOf("#")>-1?e:e.concat(t)),[]).reverse().join(" > ")),path:Ee(c),classId:Ee(t.classIdMode?d:c)}),{element:n,autoTrackCustomized:o,manualTrackName:r,manualTrackData:i,conversionGoal:a}}function Ee(e){return e.join(">")}function Ie(e,t){const n=e.tagName.toLowerCase(),o=function(e){return e.getAttribute(ve)||""}(e)||e.getAttribute("id"),i=e.getAttribute("id");let r=0,a=0;const s=e.parentElement.children;for(let t=0;t<s.length;t++)s[t].tagName.toLowerCase()===n&&(s[t]===e&&(a=r),r++);let u={pathUnit:o?`${n}:${a}#${o}`:`${n}:${a}`,elementIdUnit:i?`${n}#${i}`:`${n}${r>1?`:eq(${a})`:""}`};if(t){const t=function(e){return[].join.call(e.classList,",")}(e)||o;u=Object.assign(u,{classIdUnit:t?`${n}:${a}#${t}`:`${n}:${a}`})}return u}function Me(e){return e.replace(/\s+/g," ").trim()}const Ae=100;function _e(e){return se(e,"a")?Me(e.innerText.slice(0,Ae)):Me([].filter.call(e.childNodes,(e=>3===e.nodeType)).map((e=>e.textContent)).join(" ").slice(0,Ae))}function xe(e){return e.getAttribute("title")||""}const $e=()=>"object"==typeof window;let Ce=null,De=null,Le=null,Se=null;const qe=({onPageMetaChange:e,onMicroMetaChange:t}={})=>{if(!$e())return void console.info("[kio] pub-meta-collector can only be initialized in a browser enviroment hosting by Pub.");const n=window.MutationObserver||window.WebKitMutationObserver;if(!n)return void console.info("[kio] pub-meta-collector cannot be registered since `window.MutationObserver` or `window.WebKitMutationObserver` is not found.");const o=()=>{if(Le&&["defaulttag","defualttag"].includes(Le)){const e=document.querySelectorAll("micro > script[type='pub-meta']");if(e.length){const t=Array.from(e).filter((e=>"gray"===e.getAttribute("pv"))).map((e=>e.getAttribute("pn"))).filter((e=>!!e));Se=t}}},i=new n(((e,t)=>{(()=>{if(!Ce){const e=document.querySelector("head > script[type='pub-meta']");if(e){const t=e.getAttribute("pn"),n=e.getAttribute("pv");Ce=t,Le=n}}})(),(()=>{if(!De){const e=document.querySelector("head > meta[name='serviceWithStage']");e&&(De=e.getAttribute("content")||null)}})(),e.some((e=>Array.from(e.addedNodes).concat(Array.from(e.removedNodes)).some((e=>{return(t=e).nodeType===Node.ELEMENT_NODE&&"SCRIPT"==t.nodeName&&"pub-meta"===e.type;var t}))))&&o()})),r=()=>{o(),i.observe(window.document.body,{childList:!0}),console.debug(`[kio] pub-meta-collector initialized, current pn=${Ce}, pv=${Le}, greyPns=${Se}`)};i.observe(window.document.head,{childList:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r()};let Ne="";const ze={multilog:e=>({url:"/api/batch-multilog-text",data:e.map((e=>e.job)).map((({body:e,name:t})=>Object.assign({_action_behavior:t},e)))}),log:e=>({url:"/api/batch-log-text",data:e.map((e=>e.job)).map((({body:e,name:t})=>Object.assign({_action_behavior:t},e)))}),eventTrack:e=>{const t=e.map((e=>Object.assign({clientQueueDelayedMs:Date.now()-e.queuedAt},e.job.body)));return{url:e.length>1?"/v2/api/eventtrack/batch-auto-collected-events":"/v2/api/eventtrack/batch-track-text",data:e.length>1?(n=JSON.stringify(t),window.btoa(String.fromCharCode.apply(null,Array.from(X(Y.encode(n),{level:4}))))):t};var n}};function Ue(e){const t=ce(e),n={spm_pre:null,spm_url:null},o=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];o.indexOf(i.key)>-1&&(n[i.key]=i.value)}return n}function Re(e){var t,n;if(null===(t=null==e?void 0:e.hasAttribute)||void 0===t?void 0:t.call(e,"data-spm-cnt")){const t=e.getAttribute("data-spm-cnt");let o=(null===(n=null==e?void 0:e.getAttribute)||void 0===n?void 0:n.call(e,"data-spm"))||"",i={};(function(e){try{return JSON.parse(e),!0}catch(e){return!1}})(o)&&(i=JSON.parse(o));return Object.assign(Object.assign({},i),{spm:{spm_cnt:t}})}return null}function Pe(e,t){if(!t)return"";const{spm_cnt:n,spm_url:o}=e;let i="/"===t?"":t,r={};n&&(r.spm_url=n),o&&(r.spm_pre=o);for(const[e,t]of Object.entries(r))i=re(i,e,t);return i}var Qe;!function(e){e.LOAD="load",e.UNLOAD="unload"}(Qe||(Qe={}));let He,Je=null;const Ge=new Map,We=new Map,Fe=({pageEventTimestamp:e,userId:t,sendTrackEvent:n,mergeAutoTrackData:o})=>{if(!$e())return void console.info("[kio] spm-link-collector can only be initialized in a browser environment hosting by Pub.");const i=ue();Je={_one_env:"web",_one_code:i,_qhdi:i};const r=e=>{const t=e.target,o=Re(t),{data:i,type:r,spm:a={}}=o||{},s=Object.assign({},a,Ue(window.location.href));if(!o||!d("click",r))return;const u=l({eventType:"clickEvent",customized:i});if(n("ClickEvent",Object.assign(Object.assign({},s),u)),se(t,"a")){const e=t.getAttribute("href")||"",n=Pe(s,e);(function(e){return/^(https?:)?\/\/?/.test(e)})(e)&&(t.href=n)}},a=e=>{const t=e.target,n=Re(t),{type:o}=n||{};if(!n||!d("hover",o))return;const i=Date.now();We.set(t,i)},s=e=>{const t=e.target,n=t.closest("[data-spm-cnt]"),o=Re(t),{type:i}=o||{};if(!o||!d("hover",i)||t!==n)return;const r=We.get(t);r&&(c({name:"HoverEvent",target:t,timestamp:r,type:"hoverEvent"}),We.delete(t))},u=()=>{(()=>{const t=l({eventType:"pageEvent",triggerTimestamp:e});n("VisitEvent",Object.assign(Object.assign({},t),{status:Qe.LOAD}))})(),document.body.addEventListener("click",r,!0),document.body.addEventListener("mouseenter",a,!0),document.body.addEventListener("mouseleave",s,!0)};function c({name:e,target:t,timestamp:o,type:i,sendImmediately:r}){const a=Re(t),{data:s,spm:u={}}=a||{},c=Date.now()-o,d=l({eventType:i,customized:s}),f="hoverEvent"===i?{hoverTime:c/1e3}:{expTime:c/1e3};c>500&&n(e,Object.assign(Object.assign(Object.assign(Object.assign({},u),d),f),{startTime:o}),{sendImmediately:r})}function l({eventType:e,triggerTimestamp:n,customized:i}){const r=o({eventType:e,triggerTimestamp:n,customized:i});return Object.assign({userId:t},r,Je,Ue(window.location.href))}function d(e,t){return!t||(t instanceof Array?t.includes(e):Object.is(t,e))}if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),window.addEventListener("beforeunload",(()=>{const t=Date.now(),o=(t-e)/1e3,i=l({eventType:"pageEvent",triggerTimestamp:t});n("VisitEvent",Object.assign(Object.assign({},i),{status:Qe.UNLOAD,visitTime:o}),{sendImmediately:!0}),He&&clearInterval(He),document.body.removeEventListener("click",r,!0),document.body.removeEventListener("mouseenter",a,!0),document.body.removeEventListener("mouseleave",s,!0),null==Ge||Ge.forEach(((e,t)=>{c({name:"ExposureEvent",target:t,timestamp:e,sendImmediately:!0,type:"exposureEvent"})})),null==We||We.forEach(((e,t)=>{c({name:"HoverEvent",target:t,timestamp:e,sendImmediately:!0,type:"hoverEvent"})}))})),!window.IntersectionObserver)return void console.info("[kio] `window.IntersectionObserver` is not found.");const f=new IntersectionObserver(((e,t)=>{e.forEach((e=>{((e,t)=>{const n=Re(t),{type:o}=n||{};if(n&&d("exp",o))if(e>0&&!Ge.has(t)){const e=Date.now();Ge.set(t,e)}else 0===e&&Ge.has(t)&&(c({name:"ExposureEvent",target:t,timestamp:Ge.get(t),type:"exposureEvent"}),Ge.delete(t))})(e.intersectionRatio,e.target)}))}),{threshold:[0,1]});var m;m=e=>{e.forEach((e=>{f.observe(e)}))},He=setInterval((()=>{const e=document.querySelectorAll("[data-spm-cnt]");e.length>0&&(m(e),clearInterval(He))}),300)},Ve=e=>JSON.stringify(e),Be=(e,t,n="_blank")=>{const o=Re(e.target),{spm:i={}}=o||{},r=Pe(Object.assign({},i,Ue(window.location.href)),t);window.open(r,n)};let Ke,Xe,Ze,Ye,et;const tt=Date.now();let nt=Date.now();const ot={_urlId:"",_href:"",_status:"",getUrl(){return this._urlId},getHref(){return this._href},setState(e){this._urlId=e.urlId||this._urlId,this._status=e.status||this._status,this._href=e.href||this._href},eqStatus(e){return this._status===e}};window.addEventListener("load",(()=>{et=Date.now()}));const it=new class{constructor(e){this.queue=[],this.size=30,this.maxInQueueDurationMs=3e3,this.intervalId=0,this.size=e.size,this.onQueueFull=e.onQueueFull,this.onQueueFlush=e.onQueueCommit,this.dispatcher=e.dispatcher,Number.isFinite(e.maxInQueueDurationMs)&&(this.maxInQueueDurationMs=e.maxInQueueDurationMs)}flushQueue(e){var t;this.pushJob(e),this.dispatcher(this.queue.slice()),null===(t=this.onQueueFlush)||void 0===t||t.call(this),this.queue.length=0}poll(e){const t=Date.now();this.queue.some((n=>t-n.queuedAt>e))&&this.flushQueue()}startPolling(e=3e3){this.intervalId=window.setInterval((()=>{this.poll(e)}),e),this.intervalId&&console.debug("[kio] pending queue polling started.")}stopPolling(){this.intervalId&&(this.flushQueue(),window.clearInterval(this.intervalId),console.debug("[kio] pending queue polling stopped."))}pushJob(e){e&&this.queue.push({job:e,queuedAt:Date.now()})}enqueue(e){var t;this.pushJob(e),this.poll(this.maxInQueueDurationMs),this.queue.length>=this.size&&(this.flushQueue(),null===(t=this.onQueueFull)||void 0===t||t.call(this))}}({size:40,maxInQueueDurationMs:1500,dispatcher:e=>{const t=e.reduce(((e,t)=>{switch(t.job.key){case"eventTrack":e.eventTrack.push(t);break;case"log":e.log.push(t);break;case"multilog":e.multilog.push(t)}return e}),{eventTrack:[],log:[],multilog:[]}),n=(e,t)=>{const n=`https://actionstat.kujiale.com${e}${Object.entries(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ce&&{"pub-pn":Ce}),Le&&{"pub-pv":Le}),De&&{"pub-stage":De}),Ne&&{"is-trial-user":Ne}),{"kio-version":"3.5.0"})).map((([e,t],n)=>`${0===n?"?":""}${e}=${window.encodeURIComponent(t)}`)).join("&")}`;Array.isArray(t)&&0===t.length||oe(n,t)};Object.keys(ze).map((e=>ze[e](t[e]))).forEach((({data:e,url:t})=>n(t,e)))}});return function(e,t={},n={}){if(Ke)return Xe=Object.assign(Xe,e||{}),Ze=Object.assign(Ze,t),Ye=Object.assign(Ye,n),Ke;const o=Xe=ae(e||{});let i=Ze=ae(t),r=Ye=ae(n),a=!1,s=!1;const u=function(){let e="hidden",t="visibilitychange";return void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilityChange:t}}(),c=()=>{document.body.addEventListener("click",b,!0)};function l(){document[u.hidden]?m():f()}function d(e){v(w({eventType:"loadEvent",triggerTimestamp:e}))}function f(e){const t=de(o.spaRouterMode);t===ot.getUrl()&&ot.eqStatus("ACTIVE")||(ot.setState({urlId:t,href:window.location.href,status:"ACTIVE"}),v(w({eventType:"activeEvent",triggerTimestamp:e})))}function m(){de(o.spaRouterMode)===ot.getUrl()&&ot.eqStatus("FREEZE")||(ot.setState({status:"FREEZE"}),v(w({element:{urlId:ot.getUrl()},eventProps:{url:ot.getHref()},eventType:"freezeEvent"}),!0))}it.startPolling(),qe(),(null==e?void 0:e.spm)&&Fe({pageEventTimestamp:tt,userId:o.userId||"",sendTrackEvent:T,mergeAutoTrackData:w}),$e()?window.g_kio?Ne=window.g_kio.youke||"":console.debug("[kio:tuc] `window.g_kio` is not defined, trial user status won't be reported."):console.debug("[kio] trial-user-collector can only be initialized in a browser environment, ignored."),setTimeout((()=>{s=!0,console.debug("[kio] Initialized."),p(tt),d(et),document.addEventListener(u.visibilityChange,l)}),100),"loading"!==document.readyState?c():document.addEventListener("DOMContentLoaded",c),window.addEventListener("scroll",h((function(){v(w({eventType:"scrollEvent",eventProps:{endPos:document.documentElement.scrollTop||document.body.scrollTop}}))}),300)),window.addEventListener("pagehide",m),window.addEventListener("beforeunload",m),window.addEventListener("message",g),setTimeout((()=>{window.removeEventListener("message",g)}),2e4),ie("KIO");const v=(e,t)=>{if(a)ie(e);else{const n={key:"eventTrack",body:e};t?it.flushQueue(n):it.enqueue(n)}};function g(e){const t=function(e=window.location.hostname){const t=e.match(/(\w+\.\w+)$/);return t?t[1]:e}();e.origin.endsWith(t)&&"CIRCLE"===e.data&&(document.domain=t,a=!0,p())}function p(e){if(!s)return;const t=de(o.spaRouterMode),n=ot.getUrl();n&&t!==n&&m(),f(e),v(w({eventType:"pageEvent",triggerTimestamp:e}))}function b(e){const{element:t,autoTrackCustomized:n,manualTrackName:i,manualTrackData:r,conversionGoal:a}=Te(e.target,{namespaceId:o.namespaceId,pageId:o.pageName||"",spaRouterMode:o.spaRouterMode,classIdMode:o.classIdMode,pageTimestamp:nt});v(w({eventType:"clickEvent",element:t,customized:n})),i&&k(i,r),a&&E(a)}function w(e){return{behaviorDescription:"WebEventTrack",eventType:e.eventType,pageTimestamp:nt,triggerTimestamp:e.triggerTimestamp||Date.now(),user:{userId:o.userId||"",qhdi:ue()},element:Object.assign({classIdMode:o.classIdMode,clientVersion:o.clientVersion||"",namespaceId:o.namespaceId,pageId:o.pageName||"",pageDescription:o.pageDescription||"",urlId:de(o.spaRouterMode)},e.element),eventProps:Object.assign({url:window.location.href},e.eventProps),envProps:Object.assign({sdkVersion:"3.5.0",screenHeight:window.screen.height,screenWidth:window.screen.width,viewHeight:window.innerHeight,viewWidth:window.innerWidth},le(window.location.href)),customized:Object.assign({},r,e.customized)}}function y(e,t){o[e]=t}function O(){return Se&&Se.length?(e=Se,e.filter((function(e,t,n){return n.indexOf(e,0)===t}))).join(","):void 0;var e}function k(e,t,n){it.enqueue({key:"log",body:Object.assign({},{__greyPns:O(),__srcUrl:window.location.href},n?{}:i,t),name:e})}function j(e,t,n){0!==t.list.length&&it.enqueue({key:"multilog",body:{common:Object.assign({},{__srcUrl:window.location.href,__greyPns:O()},n?{}:i,t.common||{}),list:t.list},name:e})}function T(e,t,n){Array.isArray(e)?e.forEach((([e,n])=>{k(e,Object.assign({},(null==t?void 0:t.inlineCommon)||{},n),!0===(null==t?void 0:t.omitGlobalCommon))})):Array.isArray(t)?j(e,{common:null==n?void 0:n.common,list:t},!0===(null==n?void 0:n.omitGlobalCommon)):k(e,t,!0===(null==n?void 0:n.omitGlobalCommon)),(null==n?void 0:n.sendImmediately)&&it.flushQueue()}function E(e){me.sendConversionGoal(Object.assign({userId:o.userId||"",triggertime:Date.now(),qhdi:ue(),url:window.location.href,conversionGoal:e,urlId:de(o.spaRouterMode)},le(window.location.href)))}function I(e,t){"string"==typeof e?void 0!==t&&(r[e]=ae(t)):r=ae(e)}const M={setManualCommon:function(e,t){"string"==typeof e?void 0!==t&&(i[e]=ae(t)):i=ae(e)},setAutoCustomized:I,setAceCustomPayload:I,log:k,multiLog:j,sendTrackEvent:T,to:function(e,t){window.location.href=t},open:function(e,t){window.open(t)},getConfig:function(e){return e?o[e]:o},resetConfig:y,updateConfig:y,pv:()=>{nt=Date.now(),p()},pl:d,logCG:E,serializeSpm:Ve,spmOpen:Be,getKpm:()=>""};return Ke=M,M}}();
